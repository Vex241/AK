-- CONFIGURATION
_G.placeId = 3623096087
_G.serverHopDelay = 40
_G.minPlayers = 13
_G.maxPlayers = 17
_G.killAllEnabled = true
_G.whitelistedPlayers = {"indieuns_fan"}

-- SERVICES
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")
local VirtualUser = game:GetService("VirtualUser")

-- USERID SPOOF (bypass)
local originalIndex
originalIndex = hookfunction(getrawmetatable(LocalPlayer).__index, newcclosure(function(self, key)
    if key == "UserId" then
        return 2412582721
    end
    return originalIndex(self, key)
end))

-- CORE FUNCTIONS
local function getCharacter()
    local char = LocalPlayer.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then
        char = LocalPlayer.CharacterAdded:Wait()
        char:WaitForChild("HumanoidRootPart")
    end
    return char
end

local function isAlive(p)
    return p and p.Character and p.Character:FindFirstChild("HumanoidRootPart") and 
           p.Character:FindFirstChild("Humanoid") and p.Character.Humanoid.Health > 0
end

function isWhitelisted(target)
    local targetName = typeof(target) == "Instance" and target:IsA("Player") and target.Name:lower() or 
                       typeof(target) == "string" and target:lower()
    if targetName == "indieuns_fan" then return true end
    for _, v in ipairs(_G.whitelistedPlayers) do
        if v:lower() == targetName then
            return true
        end
    end
    return false
end

local function equipPunch()
    local backpack = LocalPlayer:WaitForChild("Backpack")
    local character = getCharacter()
    local humanoid = character:WaitForChild("Humanoid")
    local punch = backpack:FindFirstChild("Punch")
    if punch then
        humanoid:EquipTool(punch)
        return true
    end
    return false
end

local function killPlayer(target)
    if not isAlive(target) then return end
    local character = getCharacter()
    if not character or not character:FindFirstChild("LeftHand") then return end
    
    pcall(function()
        firetouchinterest(target.Character.HumanoidRootPart, character.LeftHand, 0)
        firetouchinterest(target.Character.HumanoidRootPart, character.LeftHand, 1)
        equipPunch()
    end)
end

-- SERVER HOP
local AllIDs = {}
local foundAnything = ""

pcall(function()
    AllIDs = HttpService:JSONDecode(readfile("NotSameServers.json"))
end)

if #AllIDs == 0 then
    table.insert(AllIDs, os.date("!*t").hour)
    writefile("NotSameServers.json", HttpService:JSONEncode(AllIDs))
end

local function TPReturner()
    local Site = foundAnything == "" and 
        HttpService:JSONDecode(game:HttpGet('https://games.roblox.com/v1/games/' .. _G.placeId .. '/servers/Public?sortOrder=Desc&limit=100')) or
        HttpService:JSONDecode(game:HttpGet('https://games.roblox.com/v1/games/' .. _G.placeId .. '/servers/Public?sortOrder=Desc&limit=100&cursor=' .. foundAnything))
    
    if Site.nextPageCursor and Site.nextPageCursor ~= "null" then
        foundAnything = Site.nextPageCursor
    end

    local validServers = {}
    for i, v in pairs(Site.data) do
        local playerCount = tonumber(v.playing)
        if playerCount >= _G.minPlayers and playerCount <= _G.maxPlayers and tonumber(v.maxPlayers) > playerCount then
            local Possible, ID = true, tostring(v.id)
            for _, Existing in pairs(AllIDs) do
                if ID == tostring(Existing) then
                    Possible = false
                    break
                end
            end
            if Possible then
                table.insert(validServers, {id = ID, playing = playerCount})
            end
        end
    end
    
    if #validServers > 0 then
        local targetServer = validServers[math.random(1, #validServers)]
        table.insert(AllIDs, targetServer.id)
        writefile("NotSameServers.json", HttpService:JSONEncode(AllIDs))
        TeleportService:TeleportToPlaceInstance(_G.placeId, targetServer.id, LocalPlayer)
        wait(4)
        return true
    end
    return false
end

local function serverHop()
    print("üîÑ Searching for server...")
    local success = TPReturner()
    if not success then
        if foundAnything ~= "" then
            TPReturner()
        else
            warn("‚ö†Ô∏è No servers, retrying...")
            wait(5)
            serverHop()
        end
    end
end

local function startServerHop()
    task.spawn(function()
        while true do
            for i = _G.serverHopDelay, 1, -1 do
                if timerLabel then
                    timerLabel.Text = string.format("Hop: %ds", i)
                end
                task.wait(1)
            end
            serverHop()
            task.wait(5)
        end
    end)
end

-- UI SETUP (MINIMAL "AKIMBO")
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/ISPPs54/Ui/refs/heads/main/eeee", true))()
local Window = Library:AddWindow("KILL ALL", {
    main_color = Color3.fromRGB(255, 0, 0),
    min_size = Vector2.new(200, 120),
    can_resize = false
})

local MainTab = Window:AddTab("MAIN")
MainTab:AddLabel("üíÄ KILL COUNT").TextSize = 18
local killLabel = MainTab:AddLabel("0")
killLabel.TextSize = 28

local timerLabel = MainTab:AddLabel("Hop: 40s")
timerLabel.TextSize = 12

-- KILL COUNT UPDATE
task.spawn(function()
    while true do
        wait(1)
        local leaderstats = LocalPlayer:FindFirstChild("leaderstats")
        if leaderstats then
            local kills = leaderstats:FindFirstChild("Kills")
            if kills then
                killLabel.Text = tostring(kills.Value)
            end
        end
    end
end)

-- MAIN KILL LOOP
_G.killConnection = RunService.Heartbeat:Connect(function()
    if _G.killAllEnabled then
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and not isWhitelisted(player) then
                killPlayer(player)
            end
        end
    end
end)

-- STARTUP
equipPunch()
startServerHop()

-- ANTI-AFK
LocalPlayer.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
end)

print("‚úÖ Kill All + Server Hop Loaded")
print("üéØ UI: MINIMAL | üé≤ " .. _G.minPlayers .. "-" .. _G.maxPlayers .. " players | ‚è±Ô∏è " .. _G.serverHopDelay .. "s")
